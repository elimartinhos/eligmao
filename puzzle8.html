<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <style>
        body { background: black; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: white; user-select: none; font-family: sans-serif; }
        .case { width: 380px; height: 600px; background: #1a1a1a; border: 4px solid #333; border-radius: 15px; display: flex; flex-direction: column; align-items: center; padding: 20px; position: relative; }
        .post-it { background: #ffeb3b; color: #333; padding: 10px 20px; font-family: 'Courier New', monospace; font-weight: bold; transform: rotate(-2deg); box-shadow: 5px 5px 15px rgba(0,0,0,0.5); margin-bottom: 30px; }
        .math-zone { display: grid; grid-template-columns: repeat(3, 70px); gap: 20px; text-align: center; }
        .dial-window { width: 70px; height: 80px; background: #111; border: 2px solid #444; border-radius: 8px; overflow: hidden; position: relative; cursor: pointer; transition: 0.3s; }
        .dial-window.active { border-color: #0088ff; box-shadow: 0 0 15px #0088ff; }
        .dial-strip { position: absolute; width: 100%; top: 0; left: 0; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .digit { height: 80px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; color: #eee; }
        .operator { font-size: 2rem; color: #555; align-self: center; margin: 10px 0; }
        .line { width: 250px; height: 4px; background: #333; margin: 10px 0; }
        .completed .case { filter: grayscale(1) opacity(0.3); pointer-events: none; }
        
        /* Botão Reiniciar */
        .btn-reset { margin-top: 25px; padding: 8px 16px; background: #333; color: #888; border: 1px solid #444; border-radius: 4px; cursor: pointer; font-family: monospace; font-size: 0.8rem; transition: 0.2s; text-transform: uppercase; }
        .btn-reset:hover { background: #444; color: white; border-color: #666; }
        .btn-reset:active { transform: scale(0.95); }

        #check-mark { position: absolute; font-size: 15rem; color: #00ff00; display: none; z-index: 100; text-shadow: 0 0 30px rgba(0,255,0,0.5); }
    </style>
</head>
<body>
<div id="check-mark">✓</div>
<div class="case">
    <div class="post-it">ALVO: 777</div>

    <div class="math-zone">
        <div class="dial-window" id="w0" onclick="spin(0)"><div class="dial-strip" id="s0"></div></div>
        <div class="dial-window" id="w1" onclick="spin(1)"><div class="dial-strip" id="s1"></div></div>
        <div class="dial-window" id="w2" onclick="spin(2)"><div class="dial-strip" id="s2"></div></div>
    </div>

    <div class="operator">+</div>

    <div class="math-zone">
        <div class="dial-window" id="w3" onclick="spin(3)"><div class="dial-strip" id="s3"></div></div>
        <div class="dial-window" id="w4" onclick="spin(4)"><div class="dial-strip" id="s4"></div></div>
        <div class="dial-window" id="w5" onclick="spin(5)"><div class="dial-strip" id="s5"></div></div>
    </div>

    <div class="line"></div>
    <div id="status" style="font-family: monospace; color: #555; margin-top: 20px;">CALIBRANDO...</div>
    
    <button class="btn-reset" onclick="resetPuzzle()">Reiniciar Sistema</button>
</div>

<script>
    // O segundo número começa em 1 para permitir soma total ímpar (21)
    const vals = [0, 1, 0, 0, 0, 0]; 
    const strips = Array.from({length: 6}, (_, i) => document.getElementById('s' + i));
    const windows = Array.from({length: 6}, (_, i) => document.getElementById('w' + i));

    // Conexões cruzadas (Um de cima mexe um de baixo)
    const links = { 0: 4, 1: 5, 2: 3, 3: 1, 4: 2, 5: 0 };

    // Inicializa
    strips.forEach((strip, i) => {
        for(let j=0; j<10; j++) {
            const div = document.createElement('div');
            div.className = 'digit'; div.innerText = j; strip.appendChild(div);
        }
        // Aplica posição inicial visualmente
        strip.style.transform = `translateY(-${vals[i] * 80}px)`;
    });

    function spin(idx) {
        if (navigator.vibrate) navigator.vibrate(10);
        
        updateVal(idx);         // Mexe o clicado
        updateVal(links[idx]);  // Mexe o conectado

        checkLogic();
    }

    function updateVal(i) {
        vals[i] = (vals[i] + 1) % 10;
        strips[i].style.transform = `translateY(-${vals[i] * 80}px)`;
    }

    function checkLogic() {
        let colHits = 0;
        
        // Verifica colunas: Índice 0+3, 1+4, 2+5
        for(let i=0; i<3; i++) {
            if ((vals[i] + vals[i+3]) === 7) {
                colHits++;
                windows[i].classList.add('active');
                windows[i+3].classList.add('active');
            } else {
                windows[i].classList.remove('active');
                windows[i+3].classList.remove('active');
            }
        }

        document.getElementById('status').innerText = `ESTABILIDADE: ${colHits}/3`;

        if (colHits === 3) {
            success();
        }
    }

    function resetPuzzle() {
        if (navigator.vibrate) navigator.vibrate(50);
        // Reseta para o estado inicial exato (com o índice 1 em 1)
        vals[0]=0; vals[1]=1; vals[2]=0; vals[3]=0; vals[4]=0; vals[5]=0;
        
        strips.forEach((strip, i) => {
            strip.style.transform = `translateY(-${vals[i] * 80}px)`;
        });
        checkLogic();
    }

    function success() {
        if (navigator.vibrate) navigator.vibrate(200);
        setTimeout(() => {
            document.body.classList.add('completed');
            document.getElementById('check-mark').style.display = 'block';
            window.parent.postMessage('nextPuzzle', '*');
        }, 500);
    }
    
    // Roda verificação inicial para acender luzes se já começar certo
    checkLogic();
</script>
</body>
</html>