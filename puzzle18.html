<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Puzzle 18</title>
    <style>
        body { background: #0a0a0a; margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; overflow: hidden; color: white; font-family: sans-serif; user-select: none; touch-action: none; }
        
        #game-container { position: relative; display: flex; flex-direction: column; align-items: center; gap: 20px; transition: 0.5s; }
        
        .grid { display: grid; grid-template-columns: repeat(5, 60px); grid-template-rows: repeat(5, 60px); gap: 8px; background: #222; padding: 10px; border-radius: 8px; border: 2px solid #444; }
        
        .cell { width: 60px; height: 60px; background: #1a1a1a; border-radius: 4px; position: relative; display: flex; align-items: center; justify-content: center; transition: background 0.2s; cursor: pointer; }
        
        /* Quadrados preenchidos: Verde Brilhante */
        .cell.filled { background: #2ecc71; box-shadow: inset 0 0 15px rgba(0,0,0,0.3), 0 0 10px rgba(46, 204, 113, 0.4); cursor: default; }
        
        /* Quadrado ativo: Azul */
        .cell.active { background: #0088ff !important; box-shadow: 0 0 20px #0088ff; z-index: 5; }

        .arrow { position: absolute; width: 0; height: 0; border-style: solid; cursor: pointer; z-index: 10; filter: drop-shadow(0 0 5px #00ff00); }
        .arrow-up { top: -25px; border-width: 0 15px 20px 15px; border-color: transparent transparent #00ff00 transparent; }
        .arrow-down { bottom: -25px; border-width: 20px 15px 0 15px; border-color: #00ff00 transparent transparent transparent; }
        .arrow-left { left: -25px; border-width: 15px 20px 15px 0; border-color: transparent #00ff00 transparent transparent; }
        .arrow-right { right: -25px; border-width: 15px 0 15px 20px; border-color: transparent transparent transparent #00ff00; }

        #reset-btn { width: 50px; height: 50px; background: #222; border: 2px solid #444; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        #reset-btn:hover { background: #333; }
        #reset-btn svg { width: 30px; height: 30px; fill: white; }

        .completed #game-container { filter: grayscale(1) opacity(0.3); pointer-events: none; }
        #check-mark { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 200px; color: #00ff00; display: none; z-index: 100; pointer-events: none; font-weight: bold; text-shadow: 0 0 40px rgba(0,255,0,0.6); }
    </style>
</head>
<body>

<div id="check-mark">✓</div>

<div id="game-container">
    <div id="grid" class="grid"></div>
    <div id="reset-btn" onclick="initGame()">
        <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
    </div>
</div>

<script>
    const gridEl = document.getElementById('grid');
    let cells = [];
    let filledCount = 0;
    let currentPos = null;

    function initGame() {
        document.body.classList.remove('completed');
        document.getElementById('check-mark').style.display = 'none';
        gridEl.innerHTML = '';
        cells = [];
        filledCount = 0;
        currentPos = null;

        for (let r = 0; r < 5; r++) {
            cells[r] = [];
            for (let c = 0; c < 5; c++) {
                const div = document.createElement('div');
                div.className = 'cell';
                div.onclick = () => handleCellClick(r, c);
                gridEl.appendChild(div);
                cells[r][c] = { el: div, filled: false };
            }
        }

        // Pré-preenchimento: C1, D1, E1 (Linha 0, Cols 2,3,4) e A5, B5 (Linha 4, Cols 0,1)
        const preFilled = [[0,2], [0,3], [0,4], [4,0], [4,1]];
        preFilled.forEach(pos => fillCell(pos[0], pos[1]));
        
        updateGrid();
    }

    function handleCellClick(r, c) {
        if (currentPos === null && !cells[r][c].filled) {
            fillCell(r, c);
            currentPos = { r, c };
            updateGrid();
        }
    }

    function showDirections(r, c) {
        const directions = [
            { dr: -1, dc: 0, class: 'arrow-up' },
            { dr: 1, dc: 0, class: 'arrow-down' },
            { dr: 0, dc: -1, class: 'arrow-left' },
            { dr: 0, dc: 1, class: 'arrow-right' }
        ];

        directions.forEach(dir => {
            const nr = r + dir.dr;
            const nc = c + dir.dc;
            if (isValid(nr, nc) && !cells[nr][nc].filled) {
                const arrow = document.createElement('div');
                arrow.className = `arrow ${dir.class}`;
                arrow.onclick = (e) => {
                    e.stopPropagation();
                    moveInDirection(dir.dr, dir.dc);
                };
                cells[r][c].el.appendChild(arrow);
            }
        });
    }

    function moveInDirection(dr, dc) {
        let nr = currentPos.r + dr;
        let nc = currentPos.c + dc;

        while (isValid(nr, nc) && !cells[nr][nc].filled) {
            fillCell(nr, nc);
            currentPos = { r: nr, c: nc };
            nr += dr;
            nc += dc;
        }
        
        updateGrid();
        checkWin();
    }

    function fillCell(r, c) {
        if (!cells[r][c].filled) {
            cells[r][c].filled = true;
            cells[r][c].el.classList.add('filled');
            filledCount++;
            if (navigator.vibrate) navigator.vibrate(10);
        }
    }

    function updateGrid() {
        for (let r = 0; r < 5; r++) {
            for (let c = 0; c < 5; c++) {
                cells[r][c].el.classList.remove('active');
                cells[r][c].el.innerHTML = ''; 
                if (currentPos && r === currentPos.r && c === currentPos.c) {
                    cells[r][c].el.classList.add('active');
                    showDirections(r, c);
                }
            }
        }
    }

    function isValid(r, c) {
        return r >= 0 && r < 5 && c >= 0 && c < 5;
    }

    function checkWin() {
        if (filledCount === 25) {
            document.body.classList.add('completed');
            document.getElementById('check-mark').style.display = 'block';
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
            setTimeout(() => { window.parent.postMessage('nextPuzzle', '*'); }, 2000);
        }
    }

    initGame();
</script>
</body>
</html>