<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: black; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: white; user-select: none; font-family: sans-serif; overflow: hidden; }
        
        .genius-case {
            width: 380px; height: 500px;
            background: #111; border: 4px solid #333;
            border-radius: 20px; position: relative;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; gap: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }

        .grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;
        }

        .pad {
            width: 140px; height: 140px; border-radius: 15px;
            cursor: pointer; opacity: 0.2; transition: opacity 0.1s, transform 0.1s;
            border: 4px solid rgba(255,255,255,0.05);
        }
        .pad:active { transform: scale(0.95); }
        .pad.active { opacity: 1; box-shadow: 0 0 40px currentColor; border-color: rgba(255,255,255,0.5); }

        .verde { background: #4caf50; color: #4caf50; }
        .vermelho { background: #f44336; color: #f44336; }
        .amarelo { background: #ffeb3b; color: #ffeb3b; }
        .azul { background: #2196f3; color: #2196f3; }

        .status { font-family: 'Courier New', monospace; font-size: 1.2rem; font-weight: bold; letter-spacing: 2px; color: #555; }
        .round-info { color: #aaa; font-size: 0.9rem; margin-top: -15px; }

        .completed .genius-case { filter: grayscale(1) opacity(0.3); pointer-events: none; }
        #check-mark { position: absolute; font-size: 15rem; color: #00ff00; display: none; z-index: 100; text-shadow: 0 0 30px rgba(0,255,0,0.5); }
    </style>
</head>
<body>

<div id="check-mark">✓</div>

<div class="genius-case">
    <div class="status" id="status">GENIUS</div>
    <div class="round-info" id="round-txt">RODADA 1/7</div>
    
    <div class="grid">
        <div class="pad verde" id="0" onclick="userClick(0)"></div>
        <div class="pad vermelho" id="1" onclick="userClick(1)"></div>
        <div class="pad amarelo" id="2" onclick="userClick(2)"></div>
        <div class="pad azul" id="3" onclick="userClick(3)"></div>
    </div>
</div>

<script>
    let sequence = [];
    let userSequence = [];
    let round = 1;
    let canClick = false;
    let baseSpeed = 500; 
    const pads = [document.getElementById('0'), document.getElementById('1'), document.getElementById('2'), document.getElementById('3')];

    function initGame() {
        sequence = [];
        round = 1;
        baseSpeed = 500;
        nextRound();
    }

    function nextRound() {
        userSequence = [];
        canClick = false;
        document.getElementById('round-txt').innerText = `RODADA ${round}/7`;
        
        // Aceleração de 15% por rodada (0.85)
        if (round > 1) baseSpeed *= 0.85; 
        
        sequence.push(Math.floor(Math.random() * 4));
        setTimeout(playSequence, 1000);
    }

    async function playSequence() {
        for (let i = 0; i < sequence.length; i++) {
            await flashPad(sequence[i]);
            await new Promise(r => setTimeout(r, baseSpeed * 0.5)); 
        }
        canClick = true;
    }

    function flashPad(index) {
        return new Promise(resolve => {
            pads[index].classList.add('active');
            if (navigator.vibrate) navigator.vibrate(40);
            
            setTimeout(() => {
                pads[index].classList.remove('active');
                setTimeout(resolve, 50);
            }, baseSpeed);
        });
    }

    function userClick(index) {
        if (!canClick) return;

        flashPad(index);
        userSequence.push(index);

        if (userSequence[userSequence.length - 1] !== sequence[userSequence.length - 1]) {
            gameOver();
            return;
        }

        if (userSequence.length === sequence.length) {
            canClick = false;
            if (round === 7) {
                setTimeout(success, 500);
            } else {
                round++;
                setTimeout(nextRound, 800);
            }
        }
    }

    function gameOver() {
        canClick = false;
        document.getElementById('status').innerText = "ERRO";
        document.getElementById('status').style.color = "red";
        if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
        
        setTimeout(() => {
            document.getElementById('status').innerText = "GENIUS";
            document.getElementById('status').style.color = "#555";
            initGame();
        }, 1500);
    }

    function success() {
        document.body.classList.add('completed');
        document.getElementById('check-mark').style.display = 'block';
        if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 400]);
        window.parent.postMessage('nextPuzzle', '*');
    }

    window.onload = initGame;
</script>
</body>
</html>