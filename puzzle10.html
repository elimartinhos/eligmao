<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <style>
        body { background: black; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: white; user-select: none; font-family: sans-serif; overflow: hidden; }
        .case { width: 380px; height: 600px; background: #1a1a1a; border: 4px solid #333; border-radius: 15px; display: flex; flex-direction: column; align-items: center; padding: 20px; position: relative; transition: 0.3s; }
        
        .completed .case { filter: grayscale(1) brightness(0.2); pointer-events: none; }
        #check-mark { position: absolute; font-size: 15rem; color: #00ff00; display: none; z-index: 100; text-shadow: 0 0 30px rgba(0,255,0,0.5); pointer-events: none; }

        .visor { width: 300px; height: 120px; background: #000; border: 2px solid #444; border-radius: 10px; margin: 40px 0; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .ball { width: 40px; height: 40px; border-radius: 50%; position: absolute; left: -60px; filter: blur(1px); }

        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 260px; }
        .btn { height: 70px; border-radius: 8px; border: 3px solid #333; cursor: pointer; transition: 0.1s; background: #222; position: relative; overflow: hidden; }
        .btn:active { transform: scale(0.9); filter: brightness(1.5); }
        
        .c-1 { background: #ff4444 !important; }
        .c-2 { background: #44ff44 !important; }
        .c-3 { background: #4444ff !important; }
        .c-4 { background: #ffff44 !important; }
        .c-5 { background: #ff44ff !important; }
        .c-6 { background: #44ffff !important; }

        .status { margin-top: 30px; font-family: monospace; color: white; letter-spacing: 2px; text-align: center; }
        .btn-play { margin-top: 20px; padding: 10px 30px; background: #0088ff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1.5rem; line-height: 1; }
        .btn-play:disabled { background: #333; color: #888; cursor: default; }
    </style>
</head>
<body>
<div id="check-mark">✓</div>
<div class="case" id="main-case">
    <div class="visor" id="visor">
        <div id="ball-actor" class="ball"></div>
        <div id="msg" style="font-family: monospace; color: white;">PRONTO?</div>
    </div>

    <div class="grid">
        <div class="btn c-1" onclick="tap(1)"></div>
        <div class="btn c-2" onclick="tap(2)"></div>
        <div class="btn c-3" onclick="tap(3)"></div>
        <div class="btn c-4" onclick="tap(4)"></div>
        <div class="btn c-5" onclick="tap(5)"></div>
        <div class="btn c-6" onclick="tap(6)"></div>
    </div>

    <div class="status" id="st">AGUARDANDO INÍCIO</div>
    <button class="btn-play" id="play-btn" onclick="startSequence()">➜</button>
</div>

<script>
    let sequence = [];
    let userIdx = 0;
    let isPlaying = false;
    let canInput = false;

    const colors = ['#ff4444', '#44ff44', '#4444ff', '#ffff44', '#ff44ff', '#44ffff'];
    const ball = document.getElementById('ball-actor');
    const st = document.getElementById('st');
    const playBtn = document.getElementById('play-btn');

    function startSequence() {
        if(isPlaying) return;
        isPlaying = true;
        canInput = false;
        userIdx = 0;
        sequence = [];
        
        while(sequence.length < 6) {
            let r = Math.floor(Math.random() * 6) + 1;
            if(!sequence.includes(r)) sequence.push(r);
        }

        playBtn.disabled = true;
        document.getElementById('msg').style.display = 'none';
        st.innerText = "OBSERVE...";
        runAnimation(0);
    }

    function runAnimation(idx) {
        if(idx >= 6) {
            isPlaying = false;
            canInput = true;
            st.innerText = "REPRODUZA A ORDEM!";
            playBtn.disabled = false;
            return;
        }

        const colorIdx = sequence[idx] - 1;
        ball.style.background = colors[colorIdx];
        ball.style.boxShadow = `0 0 20px ${colors[colorIdx]}`;
        
        ball.animate([
            { left: '-60px', opacity: 0 },
            { left: '50%', opacity: 1, offset: 0.5 },
            { left: '110%', opacity: 0 }
        ], {
            duration: 400,
            easing: 'ease-in-out'
        }).onfinish = () => {
            setTimeout(() => runAnimation(idx + 1), 100);
        };
    }

    function tap(num) {
        if(!canInput) return;

        if(num === sequence[userIdx]) {
            vib(20);
            userIdx++;
            st.innerText = `ACERTOU ${userIdx}/6`;
            
            if(userIdx === 6) {
                success();
            }
        } else {
            fail();
        }
    }

    function fail() {
        canInput = false;
        vib(500);
        st.innerText = "ERRO! EMBARALHANDO...";
        document.getElementById('main-case').style.borderColor = 'red';
        
        setTimeout(() => {
            document.getElementById('main-case').style.borderColor = '#333';
            startSequence();
        }, 600);
    }

    function success() {
        canInput = false;
        vib([100, 50, 100]);
        document.getElementById('st').innerText = "SEQUÊNCIA CORRETA";
        setTimeout(() => {
            document.body.classList.add('completed');
            document.getElementById('check-mark').style.display = 'block';
            window.parent.postMessage('nextPuzzle', '*');
        }, 400);
    }

    function vib(ms) { if (navigator.vibrate) navigator.vibrate(ms); }
</script>
</body>
</html>